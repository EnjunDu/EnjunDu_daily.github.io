<!-- build time:Mon Jul 22 2024 03:05:17 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://enjundu.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://enjundu.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://enjundu.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Hexo,Front Matter,code,recommendation"><link rel="canonical" href="https://enjundu.github.io/bit/%E5%AF%86%E7%A0%81%E5%B7%A5%E7%A8%8B/"><title>密码工程大作业 - BIT-study | 蓝天の网站 = Hexo</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">密码工程大作业</h1><div class="meta"><span class="item" title="Created: 2024-07-08 15:39:23"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-07-08T15:39:23+08:00">2024-07-08</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">蓝天の网站</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s2.loli.net/2024/07/04/f5ySCsjMgUO27Yh.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2024/07/04/OLqrN6bKDJHW5ek.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2024/07/04/ArOLs3qhENaXcUV.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2024/07/04/d8I9raJDhEUebpV.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2024/07/03/PwEoecqCVMZg6kp.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2024/07/04/n89zJmuTd1cqNrW.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/bit/" itemprop="item" rel="index" title="In BIT-study"><span itemprop="name">BIT-study</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="https://enjundu.github.io/bit/%E5%AF%86%E7%A0%81%E5%B7%A5%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Jack Du"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><p>目录</p><p><a href="#_Toc5215">1 引言</a></p><p><a href="#_Toc22057">2. 符号</a></p><p><a href="#_Toc14603">2.1 uBlock 所用符号</a></p><p><a href="#_Toc26774">2.2 uBlock 术语解释</a></p><p><a href="#_Toc7826">2.2.1 并置</a><br>2.2.2 半字节（Nibble）	4</p><p><a href="#_Toc1851">2.2.3 向量置换（Permutation of Vectors）</a></p><p><a href="#_Toc25622">2.2.4 轮密钥（Round Key）</a></p><p><a href="#_Toc9457">3.uBlock 分组密码及两种工作模式的来历</a></p><p><a href="#_Toc18505">3.1 uBlock 算法来历</a></p><p><a href="#_Toc10233">3.2 ECB 分组密码模式来历</a></p><p><a href="#_Toc31089">3.2.1 ECB 的设计背景</a></p><p><a href="#_Toc2653">3.2.2 ECB 的来历</a></p><p><a href="#_Toc714">3.2.3 ECB 的迭代过程</a></p><p><a href="#_Toc9825">3.2.4 ECB 的安全性讨论</a></p><p>3.3 CBC 模式分析	6<br>3.3.1 CBC 模式的设计背景	6<br>3.3.2 CBC 模式的来历	6<br>3.3.3 CBC 模式的迭代构成	6<br>3.3.4 CBC 模式的安全性讨论	7</p><p><a href="#_Toc10676">4. uBlock 加密算法的总体框架与数据结构</a></p><p><a href="#_Toc22371">4.1 uBlock 算法的总体框架</a><br>4.1.1 uBlock 加密算法	7<br>4.1.2 uBlock 解密算法	9<br>4.1.3 uBlock 密钥扩展算法	10</p><p>4.2 uBlock 算法的数据结构	11</p><p><a href="#_Toc24973">4.2.1 S 盒 (Substitution boxes)</a></p><p><a href="#_Toc6879">4.2.2 向量置换 (Vector Permutations)</a></p><p><a href="#_Toc29481">4.2.3 轮密钥 (Round Keys)</a></p><p><a href="#_Toc31348">4.2.4 密钥扩展算法 (Key Schedule)</a></p><p><a href="#_Toc7498">4.2.5 数据块的处理</a></p><p><a href="#_Toc3860">5. uBlock 的算法实现</a><br>5.1 基础代码设计	12<br>5.2 评估正确性	16<br>5.3 评估吞吐量和速度	17</p><p><a href="#_Toc23937">6 以 uBlock 的 ECB 和 CBC 模式加密朱鹮.bmp 文件</a><br>6.1 BMP 文件格式解析	18<br>6.2 BMP 文件加密技巧	18<br>6.3 ECE 和 CBC 模式加解密结果	19<br>6.3.1 ECB 模式进行加解密	19<br>6.3.2 CBC 模式进行加解密	19<br>6.3.3 ECB 和 CBC 模式的分析和对比	20</p><p><a href="#_Toc11983">7 总结</a></p><h1 id="code"><a class="anchor" href="#code">#</a> Code</h1><h2 id="ublock_bmp加密代码cbc加密cpp"><a class="anchor" href="#ublock_bmp加密代码cbc加密cpp">#</a> uBlock_bmp (加密代码)——CBC 加密.cpp</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;emmintrin.h&gt;</span><span class="comment">//sse2 header file(include sse header file)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pmmintrin.h&gt;</span> <span class="comment">//SSE3(include emmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tmmintrin.h&gt;</span><span class="comment">//SSSE3(include pmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;smmintrin.h&gt;</span><span class="comment">//SSE4.1(include tmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nmmintrin.h&gt;</span><span class="comment">//SSE4.2(include smmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrin.h&gt;</span><span class="comment">//(include immintrin.h)  </span></span></span><br><span class="line"></span><br><span class="line">__m128i S     = _mm_setr_epi8(<span class="number">0x7</span>,<span class="number">0x4</span>,<span class="number">0x9</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0x8</span>,<span class="number">0xf</span>,<span class="number">0xe</span>,<span class="number">0x1</span>,<span class="number">0x6</span>,<span class="number">0x0</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x5</span>);</span><br><span class="line">__m128i S_Inv = _mm_setr_epi8(<span class="number">0xc</span>,<span class="number">0xa</span>,<span class="number">0xe</span>,<span class="number">0xd</span>,<span class="number">0x1</span>,<span class="number">0xf</span>,<span class="number">0xb</span>,<span class="number">0x0</span>,<span class="number">0x7</span>,<span class="number">0x2</span>,<span class="number">0x5</span>,<span class="number">0x4</span>,<span class="number">0x3</span>,<span class="number">0x6</span>,<span class="number">0x9</span>,<span class="number">0x8</span>);</span><br><span class="line"></span><br><span class="line">__m128i con = _mm_set1_epi8(<span class="number">0x0f</span>);</span><br><span class="line">__m128i A1 = _mm_setr_epi8(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>);	</span><br><span class="line">__m128i A2 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>);		</span><br><span class="line">__m128i A3 = _mm_setr_epi8(<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>);		</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> Subkey[<span class="number">17</span>][<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> RC[<span class="number">16</span>][<span class="number">16</span>] = &#123;<span class="number">0x9</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x9</span>,<span class="number">0xd</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x2</span>,<span class="number">0x1</span>,<span class="number">0x3</span>,<span class="number">0x5</span>,<span class="number">0x7</span>,<span class="number">0x0</span>,<span class="number">0x6</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x2</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xc</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x4</span>,<span class="number">0xf</span>,<span class="number">0x5</span>,<span class="number">0xb</span>,<span class="number">0x1</span>,<span class="number">0xe</span>,<span class="number">0x0</span>,<span class="number">0xa</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x5</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x0</span>,<span class="number">0xf</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0xe</span>,<span class="number">0x9</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0xf</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xd</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xd</span>,<span class="number">0x9</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0x8</span>,<span class="number">0x6</span>,<span class="number">0xc</span>,<span class="number">0x2</span>,<span class="number">0x9</span>,<span class="number">0x3</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x0</span>,<span class="number">0x2</span>,<span class="number">0x4</span>,<span class="number">0x6</span>,<span class="number">0x1</span>,<span class="number">0x7</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_KeySchedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key)</span><span class="comment">// 密钥生成函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i SK = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>);	</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>);	</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)key);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)Subkey[<span class="number">0</span>], state1);</span><br><span class="line">	_mm_storeu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>), state2);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, c8);</span><br><span class="line"></span><br><span class="line">		k = _mm_loadu_si128((__m128i*)RC[i - <span class="number">1</span>]);</span><br><span class="line">		k = _mm_xor_si128(k, state1);</span><br><span class="line">		t1 =  _mm_shuffle_epi8(S, k);</span><br><span class="line">		t2 = _mm_shuffle_epi8(SK, k);</span><br><span class="line">		t3 = _mm_shuffle_epi8(t1, c5);</span><br><span class="line">		t4 = _mm_shuffle_epi8(t2, c6);</span><br><span class="line">		k = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">		k = _mm_xor_si128(k, state2);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">		state1 = k;</span><br><span class="line"></span><br><span class="line">		_mm_storeu_si128((__m128i*)Subkey[i], state1);</span><br><span class="line">		_mm_storeu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>), state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">int</span> round)</span><span class="comment">//uBlock加密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">7</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)plain);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; round; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S, state2);</span><br><span class="line"></span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(round == <span class="number">16</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[round]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[round] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)cipher, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">int</span> round)</span><span class="comment">// uBlock解密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">13</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)cipher);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = round; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S_Inv, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S_Inv, state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	k = _mm_loadu_si128((__m128i*)Subkey[<span class="number">0</span>]);</span><br><span class="line">	state1 = _mm_xor_si128(state1, k);</span><br><span class="line">	k = _mm_loadu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>));</span><br><span class="line">	state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)plain, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_Round</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen, <span class="type">int</span> cryptround)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, cryptround);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Key_Schedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *seedkey, <span class="type">int</span> keylen, <span class="type">int</span> direction, <span class="type">unsigned</span> <span class="type">char</span> *subkey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="type">int</span> i, j;</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">uBlock_128_KeySchedule</span>(seedkey);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			iv[j] ^= input[g * <span class="number">16</span> + j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			output[g * <span class="number">16</span> + j] ^= iv[j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, input+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_ECB</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> g;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uBlock_128_Encrypt</span>(input + g * <span class="number">16</span>, output + g * <span class="number">16</span>, <span class="number">16</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    *out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block_ECB</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> g;    </span><br><span class="line">    <span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">    <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uBlock_128_Decrypt</span>(input + g * <span class="number">16</span>, output + g * <span class="number">16</span>, <span class="number">16</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    *out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>] = &#123;<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>, <span class="number">0x89</span>, <span class="number">0xAB</span>, <span class="number">0xCD</span>, <span class="number">0xEF</span>, <span class="number">0xFE</span>, <span class="number">0xDC</span>, <span class="number">0xBA</span>, <span class="number">0x98</span>, <span class="number">0x76</span>, <span class="number">0x54</span>, <span class="number">0x32</span>, <span class="number">0x10</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> subkey[<span class="number">272</span>];</span><br><span class="line">    FILE *bmpFile, *encFile, *decFile;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> header[<span class="number">54</span>]; <span class="comment">// BMP 文件头大小为 54 字节</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开朱鹮.bmp文件</span></span><br><span class="line">    bmpFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮.bmp&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;open successfully！\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (bmpFile == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;open failed！\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;无法打开文件。\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取BMP文件头</span></span><br><span class="line">    <span class="built_in">fread</span>(header, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">54</span>, bmpFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建加密文件和解密文件</span></span><br><span class="line">    encFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_CBC.bmp&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    decFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_CBC_dec.bmp&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CBC加密</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> buffer[<span class="number">16</span>];</span><br><span class="line">    <span class="type">int</span> bytesRead;</span><br><span class="line">    <span class="keyword">while</span> ((bytesRead = <span class="built_in">fread</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">16</span>, bmpFile)) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 执行CBC加密操作</span></span><br><span class="line">        <span class="built_in">Crypt_Enc_Block_CBC</span>(buffer, bytesRead, buffer, &amp;bytesRead, key, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">// 将加密后的数据写入加密文件</span></span><br><span class="line">        <span class="built_in">fwrite</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), bytesRead, encFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭加密文件</span></span><br><span class="line">    <span class="built_in">fclose</span>(encFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新打开加密文件进行解密</span></span><br><span class="line">    encFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_CBC.bmp&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (encFile == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;无法打开加密文件。\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取加密文件头</span></span><br><span class="line">    <span class="built_in">fread</span>(header, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">54</span>, encFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CBC解密</span></span><br><span class="line">    <span class="keyword">while</span> ((bytesRead = <span class="built_in">fread</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">16</span>, encFile)) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 执行CBC解密操作</span></span><br><span class="line">        <span class="built_in">Crypt_Dec_Block_CBC</span>(buffer, bytesRead, buffer, &amp;bytesRead, key, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">// 将解密后的数据写入解密文件</span></span><br><span class="line">        <span class="built_in">fwrite</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), bytesRead, decFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭所有文件</span></span><br><span class="line">    <span class="built_in">fclose</span>(bmpFile);</span><br><span class="line">    <span class="built_in">fclose</span>(encFile);</span><br><span class="line">    <span class="built_in">fclose</span>(decFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="ublock_bmp加密代码ecb加密-cpp"><a class="anchor" href="#ublock_bmp加密代码ecb加密-cpp">#</a> uBlock_bmp (加密代码)——ECB 加密 .cpp</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;emmintrin.h&gt;</span><span class="comment">//sse2 header file(include sse header file)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pmmintrin.h&gt;</span> <span class="comment">//SSE3(include emmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tmmintrin.h&gt;</span><span class="comment">//SSSE3(include pmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;smmintrin.h&gt;</span><span class="comment">//SSE4.1(include tmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nmmintrin.h&gt;</span><span class="comment">//SSE4.2(include smmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrin.h&gt;</span><span class="comment">//(include immintrin.h)  </span></span></span><br><span class="line"></span><br><span class="line">__m128i S     = _mm_setr_epi8(<span class="number">0x7</span>,<span class="number">0x4</span>,<span class="number">0x9</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0x8</span>,<span class="number">0xf</span>,<span class="number">0xe</span>,<span class="number">0x1</span>,<span class="number">0x6</span>,<span class="number">0x0</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x5</span>);</span><br><span class="line">__m128i S_Inv = _mm_setr_epi8(<span class="number">0xc</span>,<span class="number">0xa</span>,<span class="number">0xe</span>,<span class="number">0xd</span>,<span class="number">0x1</span>,<span class="number">0xf</span>,<span class="number">0xb</span>,<span class="number">0x0</span>,<span class="number">0x7</span>,<span class="number">0x2</span>,<span class="number">0x5</span>,<span class="number">0x4</span>,<span class="number">0x3</span>,<span class="number">0x6</span>,<span class="number">0x9</span>,<span class="number">0x8</span>);</span><br><span class="line"></span><br><span class="line">__m128i con = _mm_set1_epi8(<span class="number">0x0f</span>);</span><br><span class="line">__m128i A1 = _mm_setr_epi8(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>);	</span><br><span class="line">__m128i A2 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>);		</span><br><span class="line">__m128i A3 = _mm_setr_epi8(<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>);		</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> Subkey[<span class="number">17</span>][<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> RC[<span class="number">16</span>][<span class="number">16</span>] = &#123;<span class="number">0x9</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x9</span>,<span class="number">0xd</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x2</span>,<span class="number">0x1</span>,<span class="number">0x3</span>,<span class="number">0x5</span>,<span class="number">0x7</span>,<span class="number">0x0</span>,<span class="number">0x6</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x2</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xc</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x4</span>,<span class="number">0xf</span>,<span class="number">0x5</span>,<span class="number">0xb</span>,<span class="number">0x1</span>,<span class="number">0xe</span>,<span class="number">0x0</span>,<span class="number">0xa</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x5</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x0</span>,<span class="number">0xf</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0xe</span>,<span class="number">0x9</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0xf</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xd</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xd</span>,<span class="number">0x9</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0x8</span>,<span class="number">0x6</span>,<span class="number">0xc</span>,<span class="number">0x2</span>,<span class="number">0x9</span>,<span class="number">0x3</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x0</span>,<span class="number">0x2</span>,<span class="number">0x4</span>,<span class="number">0x6</span>,<span class="number">0x1</span>,<span class="number">0x7</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_KeySchedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key)</span><span class="comment">// 密钥生成函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i SK = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>);	</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>);	</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)key);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)Subkey[<span class="number">0</span>], state1);</span><br><span class="line">	_mm_storeu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>), state2);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, c8);</span><br><span class="line"></span><br><span class="line">		k = _mm_loadu_si128((__m128i*)RC[i - <span class="number">1</span>]);</span><br><span class="line">		k = _mm_xor_si128(k, state1);</span><br><span class="line">		t1 =  _mm_shuffle_epi8(S, k);</span><br><span class="line">		t2 = _mm_shuffle_epi8(SK, k);</span><br><span class="line">		t3 = _mm_shuffle_epi8(t1, c5);</span><br><span class="line">		t4 = _mm_shuffle_epi8(t2, c6);</span><br><span class="line">		k = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">		k = _mm_xor_si128(k, state2);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">		state1 = k;</span><br><span class="line"></span><br><span class="line">		_mm_storeu_si128((__m128i*)Subkey[i], state1);</span><br><span class="line">		_mm_storeu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>), state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">int</span> round)</span><span class="comment">//uBlock加密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">7</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)plain);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; round; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S, state2);</span><br><span class="line"></span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(round == <span class="number">16</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[round]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[round] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)cipher, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">int</span> round)</span><span class="comment">// uBlock解密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">13</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)cipher);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = round; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S_Inv, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S_Inv, state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	k = _mm_loadu_si128((__m128i*)Subkey[<span class="number">0</span>]);</span><br><span class="line">	state1 = _mm_xor_si128(state1, k);</span><br><span class="line">	k = _mm_loadu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>));</span><br><span class="line">	state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)plain, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_Round</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen, <span class="type">int</span> cryptround)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, cryptround);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Key_Schedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *seedkey, <span class="type">int</span> keylen, <span class="type">int</span> direction, <span class="type">unsigned</span> <span class="type">char</span> *subkey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="type">int</span> i, j;</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">uBlock_128_KeySchedule</span>(seedkey);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			iv[j] ^= input[g * <span class="number">16</span> + j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			output[g * <span class="number">16</span> + j] ^= iv[j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, input+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_ECB</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> g;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uBlock_128_Encrypt</span>(input + g * <span class="number">16</span>, output + g * <span class="number">16</span>, <span class="number">16</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    *out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block_ECB</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> g;    </span><br><span class="line">    <span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">    <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uBlock_128_Decrypt</span>(input + g * <span class="number">16</span>, output + g * <span class="number">16</span>, <span class="number">16</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    *out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>] = &#123;<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>, <span class="number">0x89</span>, <span class="number">0xAB</span>, <span class="number">0xCD</span>, <span class="number">0xEF</span>, <span class="number">0xFE</span>, <span class="number">0xDC</span>, <span class="number">0xBA</span>, <span class="number">0x98</span>, <span class="number">0x76</span>, <span class="number">0x54</span>, <span class="number">0x32</span>, <span class="number">0x10</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> subkey[<span class="number">272</span>];</span><br><span class="line">    FILE *bmpFile, *encFile, *decFile;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> header[<span class="number">54</span>]; <span class="comment">// BMP 文件头大小为 54 字节</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开朱鹮.bmp文件</span></span><br><span class="line">    bmpFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮.bmp&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;open successfully！\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (bmpFile == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;open failed！\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;无法打开文件。\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取BMP文件头</span></span><br><span class="line">    <span class="built_in">fread</span>(header, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">54</span>, bmpFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建加密文件和解密文件</span></span><br><span class="line">    encFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_ECB.bmp&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    decFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_ECB_dec.bmp&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ECB加密</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> buffer[<span class="number">16</span>];</span><br><span class="line">    <span class="type">int</span> bytesRead;</span><br><span class="line">    <span class="keyword">while</span> ((bytesRead = <span class="built_in">fread</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">16</span>, bmpFile)) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 执行ECB加密操作</span></span><br><span class="line">        Crypt_Enc_Block_ECBbuffer, bytesRead, buffer, &amp;bytesRead, key, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">// 将加密后的数据写入加密文件</span></span><br><span class="line">        <span class="built_in">fwrite</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), bytesRead, encFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭加密文件</span></span><br><span class="line">    <span class="built_in">fclose</span>(encFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新打开加密文件进行解密</span></span><br><span class="line">    encFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_ECB.bmp&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (encFile == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;无法打开加密文件。\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取加密文件头</span></span><br><span class="line">    <span class="built_in">fread</span>(header, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">54</span>, encFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ECB解密</span></span><br><span class="line">    <span class="keyword">while</span> ((bytesRead = <span class="built_in">fread</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">16</span>, encFile)) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 执行ECB解密操作</span></span><br><span class="line">        <span class="built_in">Crypt_Dec_Block_ECB</span>(buffer, bytesRead, buffer, &amp;bytesRead, key, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">// 将解密后的数据写入解密文件</span></span><br><span class="line">        <span class="built_in">fwrite</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), bytesRead, decFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭所有文件</span></span><br><span class="line">    <span class="built_in">fclose</span>(bmpFile);</span><br><span class="line">    <span class="built_in">fclose</span>(encFile);</span><br><span class="line">    <span class="built_in">fclose</span>(decFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="ublock_bmp加密代码ecb加密cpp"><a class="anchor" href="#ublock_bmp加密代码ecb加密cpp">#</a> uBlock_bmp (加密代码)——ECB 加密.cpp</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;emmintrin.h&gt;</span><span class="comment">//sse2 header file(include sse header file)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pmmintrin.h&gt;</span> <span class="comment">//SSE3(include emmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tmmintrin.h&gt;</span><span class="comment">//SSSE3(include pmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;smmintrin.h&gt;</span><span class="comment">//SSE4.1(include tmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nmmintrin.h&gt;</span><span class="comment">//SSE4.2(include smmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrin.h&gt;</span><span class="comment">//(include immintrin.h)  </span></span></span><br><span class="line"></span><br><span class="line">__m128i S     = _mm_setr_epi8(<span class="number">0x7</span>,<span class="number">0x4</span>,<span class="number">0x9</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0x8</span>,<span class="number">0xf</span>,<span class="number">0xe</span>,<span class="number">0x1</span>,<span class="number">0x6</span>,<span class="number">0x0</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x5</span>);</span><br><span class="line">__m128i S_Inv = _mm_setr_epi8(<span class="number">0xc</span>,<span class="number">0xa</span>,<span class="number">0xe</span>,<span class="number">0xd</span>,<span class="number">0x1</span>,<span class="number">0xf</span>,<span class="number">0xb</span>,<span class="number">0x0</span>,<span class="number">0x7</span>,<span class="number">0x2</span>,<span class="number">0x5</span>,<span class="number">0x4</span>,<span class="number">0x3</span>,<span class="number">0x6</span>,<span class="number">0x9</span>,<span class="number">0x8</span>);</span><br><span class="line"></span><br><span class="line">__m128i con = _mm_set1_epi8(<span class="number">0x0f</span>);</span><br><span class="line">__m128i A1 = _mm_setr_epi8(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>);	</span><br><span class="line">__m128i A2 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>);		</span><br><span class="line">__m128i A3 = _mm_setr_epi8(<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>);		</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> Subkey[<span class="number">17</span>][<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> RC[<span class="number">16</span>][<span class="number">16</span>] = &#123;<span class="number">0x9</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x9</span>,<span class="number">0xd</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x2</span>,<span class="number">0x1</span>,<span class="number">0x3</span>,<span class="number">0x5</span>,<span class="number">0x7</span>,<span class="number">0x0</span>,<span class="number">0x6</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x2</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xc</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x4</span>,<span class="number">0xf</span>,<span class="number">0x5</span>,<span class="number">0xb</span>,<span class="number">0x1</span>,<span class="number">0xe</span>,<span class="number">0x0</span>,<span class="number">0xa</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x5</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x0</span>,<span class="number">0xf</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0xe</span>,<span class="number">0x9</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0xf</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xd</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xd</span>,<span class="number">0x9</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0x8</span>,<span class="number">0x6</span>,<span class="number">0xc</span>,<span class="number">0x2</span>,<span class="number">0x9</span>,<span class="number">0x3</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x0</span>,<span class="number">0x2</span>,<span class="number">0x4</span>,<span class="number">0x6</span>,<span class="number">0x1</span>,<span class="number">0x7</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_KeySchedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key)</span><span class="comment">// 密钥生成函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i SK = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>);	</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>);	</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)key);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)Subkey[<span class="number">0</span>], state1);</span><br><span class="line">	_mm_storeu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>), state2);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, c8);</span><br><span class="line"></span><br><span class="line">		k = _mm_loadu_si128((__m128i*)RC[i - <span class="number">1</span>]);</span><br><span class="line">		k = _mm_xor_si128(k, state1);</span><br><span class="line">		t1 =  _mm_shuffle_epi8(S, k);</span><br><span class="line">		t2 = _mm_shuffle_epi8(SK, k);</span><br><span class="line">		t3 = _mm_shuffle_epi8(t1, c5);</span><br><span class="line">		t4 = _mm_shuffle_epi8(t2, c6);</span><br><span class="line">		k = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">		k = _mm_xor_si128(k, state2);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">		state1 = k;</span><br><span class="line"></span><br><span class="line">		_mm_storeu_si128((__m128i*)Subkey[i], state1);</span><br><span class="line">		_mm_storeu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>), state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">int</span> round)</span><span class="comment">//uBlock加密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">7</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)plain);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; round; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S, state2);</span><br><span class="line"></span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(round == <span class="number">16</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[round]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[round] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)cipher, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">int</span> round)</span><span class="comment">// uBlock解密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">13</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)cipher);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = round; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S_Inv, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S_Inv, state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	k = _mm_loadu_si128((__m128i*)Subkey[<span class="number">0</span>]);</span><br><span class="line">	state1 = _mm_xor_si128(state1, k);</span><br><span class="line">	k = _mm_loadu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>));</span><br><span class="line">	state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)plain, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_Round</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen, <span class="type">int</span> cryptround)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, cryptround);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Key_Schedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *seedkey, <span class="type">int</span> keylen, <span class="type">int</span> direction, <span class="type">unsigned</span> <span class="type">char</span> *subkey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="type">int</span> i, j;</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">uBlock_128_KeySchedule</span>(seedkey);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			iv[j] ^= input[g * <span class="number">16</span> + j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			output[g * <span class="number">16</span> + j] ^= iv[j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, input+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_ECB</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> g;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uBlock_128_Encrypt</span>(input + g * <span class="number">16</span>, output + g * <span class="number">16</span>, <span class="number">16</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    *out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block_ECB</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> g;    </span><br><span class="line">    <span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">    <span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uBlock_128_Decrypt</span>(input + g * <span class="number">16</span>, output + g * <span class="number">16</span>, <span class="number">16</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    *out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>] = &#123;<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>, <span class="number">0x89</span>, <span class="number">0xAB</span>, <span class="number">0xCD</span>, <span class="number">0xEF</span>, <span class="number">0xFE</span>, <span class="number">0xDC</span>, <span class="number">0xBA</span>, <span class="number">0x98</span>, <span class="number">0x76</span>, <span class="number">0x54</span>, <span class="number">0x32</span>, <span class="number">0x10</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> subkey[<span class="number">272</span>];</span><br><span class="line">    FILE *bmpFile, *encFile, *decFile;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> header[<span class="number">54</span>]; <span class="comment">// BMP 文件头大小为 54 字节</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开朱鹮.bmp文件</span></span><br><span class="line">    bmpFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮.bmp&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;open successfully！\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (bmpFile == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;open failed！\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;无法打开文件。\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取BMP文件头</span></span><br><span class="line">    <span class="built_in">fread</span>(header, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">54</span>, bmpFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建加密文件和解密文件</span></span><br><span class="line">    encFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_CBC.bmp&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    decFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_CBC_dec.bmp&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CBC加密</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> buffer[<span class="number">16</span>];</span><br><span class="line">    <span class="type">int</span> bytesRead;</span><br><span class="line">    <span class="keyword">while</span> ((bytesRead = <span class="built_in">fread</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">16</span>, bmpFile)) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 执行CBC加密操作</span></span><br><span class="line">        <span class="built_in">Crypt_Enc_Block_CBC</span>(buffer, bytesRead, buffer, &amp;bytesRead, key, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">// 将加密后的数据写入加密文件</span></span><br><span class="line">        <span class="built_in">fwrite</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), bytesRead, encFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭加密文件</span></span><br><span class="line">    <span class="built_in">fclose</span>(encFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新打开加密文件进行解密</span></span><br><span class="line">    encFile = <span class="built_in">fopen</span>(<span class="string">&quot;朱鹮_CBC.bmp&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (encFile == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;无法打开加密文件。\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取加密文件头</span></span><br><span class="line">    <span class="built_in">fread</span>(header, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">54</span>, encFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CBC解密</span></span><br><span class="line">    <span class="keyword">while</span> ((bytesRead = <span class="built_in">fread</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), <span class="number">16</span>, encFile)) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 执行CBC解密操作</span></span><br><span class="line">        <span class="built_in">Crypt_Dec_Block_CBC</span>(buffer, bytesRead, buffer, &amp;bytesRead, key, <span class="number">16</span>);</span><br><span class="line">        <span class="comment">// 将解密后的数据写入解密文件</span></span><br><span class="line">        <span class="built_in">fwrite</span>(buffer, <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>), bytesRead, decFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭所有文件</span></span><br><span class="line">    <span class="built_in">fclose</span>(bmpFile);</span><br><span class="line">    <span class="built_in">fclose</span>(encFile);</span><br><span class="line">    <span class="built_in">fclose</span>(decFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="ublock_windows_128_128-_测试时间cpp"><a class="anchor" href="#ublock_windows_128_128-_测试时间cpp">#</a> uBlock_Windows_128_128 _测试时间.cpp</h2><p></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;emmintrin.h&gt;</span><span class="comment">//sse2 header file(include sse header file)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pmmintrin.h&gt;</span> <span class="comment">//SSE3(include emmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tmmintrin.h&gt;</span><span class="comment">//SSSE3(include pmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;smmintrin.h&gt;</span><span class="comment">//SSE4.1(include tmmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nmmintrin.h&gt;</span><span class="comment">//SSE4.2(include smmintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;intrin.h&gt;</span><span class="comment">//(include immintrin.h)  </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line">__m128i S     = _mm_setr_epi8(<span class="number">0x7</span>,<span class="number">0x4</span>,<span class="number">0x9</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0x8</span>,<span class="number">0xf</span>,<span class="number">0xe</span>,<span class="number">0x1</span>,<span class="number">0x6</span>,<span class="number">0x0</span>,<span class="number">0x3</span>,<span class="number">0x2</span>,<span class="number">0x5</span>);</span><br><span class="line">__m128i S_Inv = _mm_setr_epi8(<span class="number">0xc</span>,<span class="number">0xa</span>,<span class="number">0xe</span>,<span class="number">0xd</span>,<span class="number">0x1</span>,<span class="number">0xf</span>,<span class="number">0xb</span>,<span class="number">0x0</span>,<span class="number">0x7</span>,<span class="number">0x2</span>,<span class="number">0x5</span>,<span class="number">0x4</span>,<span class="number">0x3</span>,<span class="number">0x6</span>,<span class="number">0x9</span>,<span class="number">0x8</span>);</span><br><span class="line"></span><br><span class="line">__m128i con = _mm_set1_epi8(<span class="number">0x0f</span>);</span><br><span class="line">__m128i A1 = _mm_setr_epi8(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>);	</span><br><span class="line">__m128i A2 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>);		</span><br><span class="line">__m128i A3 = _mm_setr_epi8(<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>);		</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> Subkey[<span class="number">17</span>][<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> RC[<span class="number">16</span>][<span class="number">16</span>] = &#123;<span class="number">0x9</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x9</span>,<span class="number">0xd</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x2</span>,<span class="number">0x1</span>,<span class="number">0x3</span>,<span class="number">0x5</span>,<span class="number">0x7</span>,<span class="number">0x0</span>,<span class="number">0x6</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x2</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xc</span>,<span class="number">0x7</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x4</span>,<span class="number">0xf</span>,<span class="number">0x5</span>,<span class="number">0xb</span>,<span class="number">0x1</span>,<span class="number">0xe</span>,<span class="number">0x0</span>,<span class="number">0xa</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x5</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0xa</span>,<span class="number">0x0</span>,<span class="number">0xf</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x9</span>,<span class="number">0x2</span>,<span class="number">0xd</span>,<span class="number">0x6</span>,<span class="number">0x8</span>,<span class="number">0x7</span>,<span class="number">0xc</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x7</span>,<span class="number">0xb</span>,<span class="number">0x3</span>,<span class="number">0xf</span>,<span class="number">0x6</span>,<span class="number">0xe</span>,<span class="number">0x2</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x8</span>,<span class="number">0xe</span>,<span class="number">0x9</span>,<span class="number">0xa</span>,<span class="number">0xd</span>,<span class="number">0xf</span>,<span class="number">0xc</span>,<span class="number">0xb</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xd</span>,<span class="number">0xc</span>,<span class="number">0xc</span>,<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="number">0xd</span>,<span class="number">0x9</span>,<span class="number">0x9</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x7</span>,<span class="number">0x8</span>,<span class="number">0x6</span>,<span class="number">0xc</span>,<span class="number">0x2</span>,<span class="number">0x9</span>,<span class="number">0x3</span>,<span class="number">0xd</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0x3</span>,<span class="number">0x0</span>,<span class="number">0x2</span>,<span class="number">0x4</span>,<span class="number">0x6</span>,<span class="number">0x1</span>,<span class="number">0x7</span>,<span class="number">0x5</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,</span><br><span class="line"><span class="number">0xa</span>,<span class="number">0x1</span>,<span class="number">0xb</span>,<span class="number">0x5</span>,<span class="number">0xf</span>,<span class="number">0x0</span>,<span class="number">0xe</span>,<span class="number">0x4</span>,<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_KeySchedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key)</span><span class="comment">// 密钥生成函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i SK = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>);	</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>);	</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)key);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)Subkey[<span class="number">0</span>], state1);</span><br><span class="line">	_mm_storeu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>), state2);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, c8);</span><br><span class="line"></span><br><span class="line">		k = _mm_loadu_si128((__m128i*)RC[i - <span class="number">1</span>]);</span><br><span class="line">		k = _mm_xor_si128(k, state1);</span><br><span class="line">		t1 =  _mm_shuffle_epi8(S, k);</span><br><span class="line">		t2 = _mm_shuffle_epi8(SK, k);</span><br><span class="line">		t3 = _mm_shuffle_epi8(t1, c5);</span><br><span class="line">		t4 = _mm_shuffle_epi8(t2, c6);</span><br><span class="line">		k = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">		k = _mm_xor_si128(k, state2);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">		state1 = k;</span><br><span class="line"></span><br><span class="line">		_mm_storeu_si128((__m128i*)Subkey[i], state1);</span><br><span class="line">		_mm_storeu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>), state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">int</span> round)</span><span class="comment">//uBlock加密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">7</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)plain);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; round; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S, state2);</span><br><span class="line"></span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(round == <span class="number">16</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[round]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[round] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)cipher, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uBlock_128_Decrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *cipher, <span class="type">unsigned</span> <span class="type">char</span> *plain, <span class="type">int</span> round)</span><span class="comment">// uBlock解密函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	__m128i L1 = _mm_setr_epi8(<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">13</span>);		</span><br><span class="line">	__m128i L2 = _mm_setr_epi8(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">3</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c1 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c2 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">0x80</span>, <span class="number">2</span>, <span class="number">0x80</span>, <span class="number">3</span>, <span class="number">0x80</span>, <span class="number">4</span>, <span class="number">0x80</span>, <span class="number">5</span>, <span class="number">0x80</span>, <span class="number">6</span>, <span class="number">0x80</span>, <span class="number">7</span>);		</span><br><span class="line">	__m128i c3 = _mm_setr_epi8(<span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c4 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">8</span>, <span class="number">0x80</span>, <span class="number">9</span>, <span class="number">0x80</span>, <span class="number">10</span>, <span class="number">0x80</span>, <span class="number">11</span>, <span class="number">0x80</span>, <span class="number">12</span>, <span class="number">0x80</span>, <span class="number">13</span>, <span class="number">0x80</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">15</span>);	</span><br><span class="line"></span><br><span class="line">	__m128i c5 = _mm_setr_epi8(<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);	</span><br><span class="line">	__m128i c6 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>);		</span><br><span class="line">	__m128i c7 = _mm_setr_epi8(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>);		</span><br><span class="line">	__m128i c8 = _mm_setr_epi8(<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>);		</span><br><span class="line"></span><br><span class="line">	__m128i state1, state2, k, t1, t2, t3, t4;  </span><br><span class="line"></span><br><span class="line">	state2 = _mm_loadu_si128((__m128i*)cipher);</span><br><span class="line">	state1 = _mm_srli_epi16(state2, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_and_si128(state1, con);</span><br><span class="line">	state2 = _mm_and_si128(state2, con);</span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c1);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c2);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c3);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c4);</span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = round; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)Subkey[i]);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_loadu_si128((__m128i*)(Subkey[i] + <span class="number">16</span>));</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(state1, L1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(state2, L2);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_xor_si128(state1, state2);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A3);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A2);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state1, A2);</span><br><span class="line">		state2 = _mm_xor_si128(state2, k);</span><br><span class="line">		k = _mm_shuffle_epi8(state2, A1);</span><br><span class="line">		state1 = _mm_xor_si128(state1, k);</span><br><span class="line">		state2 = _mm_xor_si128(state2, state1);</span><br><span class="line"></span><br><span class="line">		state1 = _mm_shuffle_epi8(S_Inv, state1);</span><br><span class="line">		state2 = _mm_shuffle_epi8(S_Inv, state2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	k = _mm_loadu_si128((__m128i*)Subkey[<span class="number">0</span>]);</span><br><span class="line">	state1 = _mm_xor_si128(state1, k);</span><br><span class="line">	k = _mm_loadu_si128((__m128i*)(Subkey[<span class="number">0</span>] + <span class="number">16</span>));</span><br><span class="line">	state2 = _mm_xor_si128(state2, k);</span><br><span class="line"></span><br><span class="line">	t1 = _mm_shuffle_epi8(state1, c5);</span><br><span class="line">	t2 = _mm_shuffle_epi8(state2, c6);</span><br><span class="line">	t3 = _mm_shuffle_epi8(state1, c7);</span><br><span class="line">	t4 = _mm_shuffle_epi8(state2, c8);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_xor_si128(t1, t2);</span><br><span class="line">	state2 = _mm_xor_si128(t3, t4);</span><br><span class="line"></span><br><span class="line">	state1 = _mm_slli_epi16(state1, <span class="number">4</span>);</span><br><span class="line">	state1 = _mm_xor_si128(state1, state2);</span><br><span class="line"></span><br><span class="line">	_mm_storeu_si128((__m128i*)plain, state1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_Round</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen, <span class="type">int</span> cryptround)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, cryptround);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Key_Schedule</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *seedkey, <span class="type">int</span> keylen, <span class="type">int</span> direction, <span class="type">unsigned</span> <span class="type">char</span> *subkey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="type">int</span> i, j;</span><br><span class="line">   </span><br><span class="line">   <span class="built_in">uBlock_128_KeySchedule</span>(seedkey);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">0</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(direction == <span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">	   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++)</span><br><span class="line">	   &#123;</span><br><span class="line">		   <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		   &#123;</span><br><span class="line">			   subkey[i * <span class="number">16</span> + j] = (Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j] &lt;&lt; <span class="number">4</span>) ^ Subkey[<span class="number">16</span> - i][<span class="number">2</span> * j + <span class="number">1</span>];</span><br><span class="line">		   &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Enc_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input, <span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			iv[j] ^= input[g * <span class="number">16</span> + j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">uBlock_128_Encrypt</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Crypt_Dec_Block_CBC</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *input,<span class="type">int</span> in_len, <span class="type">unsigned</span> <span class="type">char</span> *output,<span class="type">int</span> *out_len, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> keylen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> g, j;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">uBlock_128_KeySchedule</span>(key);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (g = <span class="number">0</span>; g &lt; in_len / <span class="number">16</span>; g++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">uBlock_128_Decrypt</span>(input+g*<span class="number">16</span>, output+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			output[g * <span class="number">16</span> + j] ^= iv[j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memcpy</span>(iv, input+g*<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	*out_len = in_len - in_len % <span class="number">16</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>]   = &#123;<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xAB</span>,<span class="number">0xCD</span>,<span class="number">0xEF</span>,<span class="number">0xFE</span>,<span class="number">0xDC</span>,<span class="number">0xBA</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span>&#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> plain[<span class="number">16</span>]   = &#123;<span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xAB</span>,<span class="number">0xCD</span>,<span class="number">0xEF</span>,<span class="number">0xFE</span>,<span class="number">0xDC</span>,<span class="number">0xBA</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span>&#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> cipher[<span class="number">16</span>], subkey[<span class="number">272</span>];</span><br><span class="line">	<span class="keyword">for</span>(r = <span class="number">0</span>; r &lt; <span class="number">1000000</span>; r++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">Crypt_Enc_Block</span>(plain, <span class="number">16</span>, cipher, &amp;j, key, <span class="number">16</span>);	</span><br><span class="line">		<span class="built_in">memcpy</span>(plain, cipher, <span class="number">16</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, cipher[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="keyword">auto</span> duration = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end - start);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Execution time: &quot;</span> &lt;&lt; duration.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; milliseconds&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h1 id="关于ublock加密算法的调研分析"><a class="anchor" href="#关于ublock加密算法的调研分析">#</a> <strong>关于 uBlock 加密算法的调研分析</strong></h1><p>目录</p><p><a href="#_Toc5215">1 引言</a></p><p><a href="#_Toc22057">2. 符号</a></p><p><a href="#_Toc14603">2.1 uBlock 所用符号</a></p><p><a href="#_Toc26774">2.2 uBlock 术语解释</a></p><p><a href="#_Toc7826">2.2.1 并置</a><br>2.2.2 半字节（Nibble）	4</p><p><a href="#_Toc1851">2.2.3 向量置换（Permutation of Vectors）</a></p><p><a href="#_Toc25622">2.2.4 轮密钥（Round Key）</a></p><p><a href="#_Toc9457">3.uBlock 分组密码及两种工作模式的来历</a></p><p><a href="#_Toc18505">3.1 uBlock 算法来历</a></p><p><a href="#_Toc10233">3.2 ECB 分组密码模式来历</a></p><p><a href="#_Toc31089">3.2.1 ECB 的设计背景</a></p><p><a href="#_Toc2653">3.2.2 ECB 的来历</a></p><p><a href="#_Toc714">3.2.3 ECB 的迭代过程</a></p><p><a href="#_Toc9825">3.2.4 ECB 的安全性讨论</a></p><p>3.3 CBC 模式分析	6<br>3.3.1 CBC 模式的设计背景	6<br>3.3.2 CBC 模式的来历	6<br>3.3.3 CBC 模式的迭代构成	6<br>3.3.4 CBC 模式的安全性讨论	7</p><p><a href="#_Toc10676">4. uBlock 加密算法的总体框架与数据结构</a></p><p><a href="#_Toc22371">4.1 uBlock 算法的总体框架</a><br>4.1.1 uBlock 加密算法	7<br>4.1.2 uBlock 解密算法	9<br>4.1.3 uBlock 密钥扩展算法	10</p><p>4.2 uBlock 算法的数据结构	11</p><p><a href="#_Toc24973">4.2.1 S 盒 (Substitution boxes)</a></p><p><a href="#_Toc6879">4.2.2 向量置换 (Vector Permutations)</a></p><p><a href="#_Toc29481">4.2.3 轮密钥 (Round Keys)</a></p><p><a href="#_Toc31348">4.2.4 密钥扩展算法 (Key Schedule)</a></p><p><a href="#_Toc7498">4.2.5 数据块的处理</a></p><p><a href="#_Toc3860">5. uBlock 的算法实现</a><br>5.1 基础代码设计	12<br>5.2 评估正确性	16<br>5.3 评估吞吐量和速度	17</p><p><a href="#_Toc23937">6 以 uBlock 的 ECB 和 CBC 模式加密朱鹮.bmp 文件</a><br>6.1 BMP 文件格式解析	18<br>6.2 BMP 文件加密技巧	18<br>6.3 ECE 和 CBC 模式加解密结果	19<br>6.3.1 ECB 模式进行加解密	19<br>6.3.2 CBC 模式进行加解密	19<br>6.3.3 ECB 和 CBC 模式的分析和对比	20</p><p><a href="#_Toc11983">7 总结</a></p><h1 id="关于ublock加密算法的调研分析-2"><a class="anchor" href="#关于ublock加密算法的调研分析-2">#</a> <strong>关于 uBlock 加密算法的调研分析</strong></h1><p>**** 摘要：**** 本文深入研究了 uBlock 和 ECB 两种分组密码算法，介绍了这两种算法的起源、设计原理、实现方法以及应用场景。通过对 uBlock 算法的详细剖析，解释了其设计的技术标准、密钥扩展机制以及加解密流程。此外，还探讨了 ECB 模式的设计背景与安全性讨论，指出了其在特定应用中的局限性。文章还包括了使用 C++ 实现的算法编程实例，验证了算法的正确性，并通过加密图像文件的实验，评估了两种算法在不同工作模式下的性能和安全性。通过实际应用案例，本文展示了分组密码在信息安全领域的重要性和实用价值。</p><p>**** 关键词：**** 分组密码，uBlock，ECB 模式，密钥扩展，算法安全性，图像加密</p><h2 id="1-引言"><a class="anchor" href="#1-引言">#</a> <strong>1 引言</strong></h2><p>随着信息技术的迅速发展，数据安全和隐私保护成为了网络空间安全的重要组成部分。分组密码作为保护电子数据的基本手段，承担着加密重要信息、防止数据泄露的关键角色。本文选择了两种具有代表性的分组密码算法：uBlock 和 ECB 模式，对它们的设计理念、实现过程以及安全性能进行了全面的分析和评估。</p><p>uBlock 算法源于全国密码算法设计竞赛，它使用复杂的密钥扩展和多轮加密机制来提高安全性。这种算法设计考虑到了抵抗差分攻击和线性攻击的需求，适合于需要高安全标准的应用场景。而 ECB 模式，作为一种基础的加密模式，因其实现的简单性，在某些低安全需求的场合中仍被广泛使用，尽管它在处理大量具有重复模式的数据时存在安全隐患。</p><p>在此基础上，本文还实现了这两种算法的编程模拟，并通过加密和解密图像文件的方法，直观地展示了它们在实际应用中的效果和性能，旨在为读者提供对分组密码在现实世界中应用的深入理解。通过对比分析和实验验证，本文不仅增强了对这两种算法性能和安全性的认识，也为未来选择和设计更加安全高效的加密方案提供了宝贵的经验和见解。</p><p><strong>2. 符号</strong></p><p><strong>2.1 uBlock 所用符号</strong></p><p>表 1 uBlock 符号表</p><table><thead><tr><th><strong>X</strong></th><th><strong>n</strong> 比特明文</th></tr></thead><tbody><tr><td><strong>Y</strong></td><td>n 比特密文</td></tr><tr><td><strong>K</strong></td><td>k 比特密钥</td></tr><tr><td><strong>PK****i</strong></td><td>n 比特轮密钥</td></tr><tr><td><strong>PL<strong><strong>n</strong></strong>，PR<strong><strong>n</strong></strong>，PL****-1****，PR<strong><strong>n</strong></strong>-1</strong></td><td>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps13.png)</td></tr><tr><td><strong>s</strong></td><td>4 比特 S 盒</td></tr><tr><td><strong>S<strong><strong>n</strong></strong>，S<strong><strong>n</strong></strong>-1</strong></td><td>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps14.png)</td></tr><tr><td><strong>S****k</strong></td><td>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps15.png)</td></tr><tr><td><strong>PK****1</strong></td><td>16 个半字节的向量置换</td></tr><tr><td><strong>PK<strong><strong>2</strong></strong>，PK****3</strong></td><td>32 个半字节的向量置换</td></tr><tr><td>⊕</td><td>模 2 加运算</td></tr><tr><td>&lt;&lt;&lt;b</td><td>循环左移 b 比特</td></tr><tr><td>&lt;&lt;&lt;b 32</td><td>分款 32 比特循环左移 b 比特</td></tr><tr><td>||</td><td>表示比特串的连接</td></tr></tbody></table><h4 id="22-ublock术语解释"><a class="anchor" href="#22-ublock术语解释">#</a> <strong>2.2 uBlock 术语解释</strong></h4><h5 id="221-并置"><a class="anchor" href="#221-并置">#</a> <strong>2.2.1 并置</strong></h5><p>在密码学和算法设计中，&quot;并置&quot;（Concatenation）通常指的是将多个数据元素或操作按顺序排列在一起，形成一个连续的整体。在 uBlock 算法的上下文中，这个术语特别指向几个方面：<br>S 盒并置：在 uBlock 算法中，一个 S 盒操作通常处理 4 比特的输入，输出也是 4 比特。当我们谈到 &quot;S 盒并置&quot; 时，这意味着将多个 S 盒操作排列在一起，以并行处理更多的数据位。</p><p>例如，如果有一个 128 比特的数据块，而每个 S 盒处理 4 比特，那么需要 32 个这样的 S 盒并置在一起，以便同时处理所有 128 比特。这 32 个 S 盒可以是相同的（即使用相同的替换规则），或者各不相同，具体取决于算法设计。</p><p>数据并置：数据并置是指将多个较小的数据块（如多个 4 比特的输出）结合成一个较大的数据块。在 uBlock 中，经过 S 盒处理的数据通常需要进行进一步的变换，如置换或与轮密钥进行 XOR 操作，这时候并置的数据可以直接用于这些操作。</p><p><strong>2.2.2 半字节（Nibble）</strong><br>半字节通常指的是 4 比特的数据块。在一个字节（通常为 8 比特）中包含两个半字节。在许多加密算法中，尤其是在对数据执行 S 盒变换时，常常以半字节为单位来处理数据。使用半字节是因为它允许在较小的数据单位上进行高效的非线性变换，这在很多加密标准（如 AES 的前身 DES）中是一种常见的做法。</p><h5 id="223-向量置换permutation-of-vectors"><a class="anchor" href="#223-向量置换permutation-of-vectors">#</a> <strong>2.2.3 向量置换（Permutation of Vectors）</strong></h5><p>向量置换涉及对一个数据向量（可以理解为一系列数据元素的数组）进行重新排序或置换。在密码学中，这种操作用于打乱数据元素的顺序，增加密码算法的扩散性质。扩散是指输入的一个小变化（比如改变一个比特）会影响输出中多个或大部分比特的属性，从而提高了算法的安全性。</p><p>向量置换的具体实例包括 PL 和 PR 操作：这些是特定的置换操作，它们以某种特定的顺序重新排列输入向量的元素。这些置换规则通常事先定义好，并用于算法的各个阶段来增加复杂性和安全性。</p><h5 id="224轮密钥round-key"><a class="anchor" href="#224轮密钥round-key">#</a> <strong>2.2.4 轮密钥（Round Key）</strong></h5><p>在循环结构的密码算法中（如 AES 或 uBlock），轮密钥是密钥扩展过程生成的一系列密钥，每一轮加密使用一种不同的轮密钥。使用不同的轮密钥是为了防止某些攻击技术，比如差分攻击和线性攻击，它们可能在多轮中利用相同密钥的重复使用来推导出密钥信息。</p><h2 id="3ublock分组密码及两种工作模式的来历"><a class="anchor" href="#3ublock分组密码及两种工作模式的来历">#</a> <strong>3.uBlock 分组密码及两种工作模式的来历</strong></h2><h4 id="31-ublock算法来历"><a class="anchor" href="#31-ublock算法来历">#</a> <strong>3.1 uBlock 算法来历</strong></h4><p>中国全国密码算法设计竞赛是一个旨在推动密码学领域技术进步的活动。为贯彻落实习近平网络强国战略思想和党的十九大精神，繁荣我国密码理论和应用研究，推动密码算法设计和实现技术进步，促进密码人才成长，学会决定举办全国密码算法设计竞赛。在 2019 年 10 月 25 日，中国密码学会发出了全国密码算法设计竞赛通知。在这个竞赛中，密码学家们提交自己设计的密码算法，经过评审和测试，优秀的算法将进入下一轮评选。</p><p>该分组密码算法的设计和提交必须符合一系列详尽的技术标准，以确保算法的安全性、高效性及实用性。首先，算法需提供完整的描述，包括所有必要的数学公式、图表和参数，并附上充分的测试实例来验证算法的正确性。设计原理部分应详细阐述算法的构思、主要策略及关键设计决策。安全性分析要详细评估算法对抗各种已知攻击的能力，包括理论上的安全证明及特殊密钥条件的分析。性能分析需考虑算法在不同的软硬件环境下的运行效率和资源消耗。此外，还必须清楚地声明算法的优点和可能的不足，包括创新性和在各种平台上的表现。算法还需要提供标准的 ANSI C 编程接口，确保其实现的标准化和可移植性。最后，参赛者必须提交一套完整的材料，包括算法描述、代码实现、支持文档及原创性声明，所有提交材料需用中文撰写，以满足比赛的形式规范。这些严格的要求确保了提交的分组密码算法既安全可靠，又具备实际应用的可行性和效率。</p><p>而 uBlock 分组密码算法是本次密码算法设计竞赛的获奖作品，由来自中国科学院软件研究所的吴文玲、张 蕾、郑雅菲、李灵琛共同设计而来。</p><h4 id="32-ecb分组密码模式来历"><a class="anchor" href="#32-ecb分组密码模式来历">#</a> <strong>3.2 ECB 分组密码模式来历</strong></h4><p>ECB（电子密码本模式，Electronic Codebook Mode）是一种基础的加密算法模式，其设计背景和迭代过程可以追溯到早期的计算机安全需求。</p><h5 id="321-ecb的设计背景"><a class="anchor" href="#321-ecb的设计背景">#</a> <strong>3.2.1 ECB 的设计背景</strong></h5><p>在早期计算机网络和系统中，数据安全开始受到关注，特别是在商业和政府通信中。随着信息技术的发展，保护数据免受未经授权的访问变得尤为重要。在此背景下，ECB 模式作为一种基本的加密模式应运而生，其主要目的是提供一种简单直接的方法来加密固定大小的数据块。</p><h5 id="322-ecb的来历"><a class="anchor" href="#322-ecb的来历">#</a> <strong>3.2.2 ECB 的来历</strong></h5><p>ECB 模式的核心概念非常简单：将明文分割成多个等长的块，每个块独立加密。这种模式的一个关键特点是它不涉及复杂的初始化向量（IV）或状态维护，这使得实现起来相对简单直接。ECB 模式可以使用任何固定长度的块密码来加密数据，如 DES（数据加密标准）或后来的 AES（高级加密标准）。</p><h5 id="323-ecb的迭代过程"><a class="anchor" href="#323-ecb的迭代过程">#</a> <strong>3.2.3 ECB 的迭代过程</strong></h5><p>ECB 模式的设计没有经历复杂的迭代过程，因为它本质上是最简单的块密码加密模式。然而，随着对加密技术的理解加深，安全社区逐渐认识到 ECB 模式在安全性方面的局限性，尤其是其在处理大量数据时容易泄露模式信息的问题。因此，出现了更为复杂的加密模式，如 CBC（密码块链接模式）、CFB（密码反馈模式）和 OFB（输出反馈模式），这些模式通过引入 IV 和更复杂的运算过程来增强安全性，从而克服了 ECB 的一些安全缺陷。</p><h5 id="324-ecb的安全性讨论"><a class="anchor" href="#324-ecb的安全性讨论">#</a> <strong>3.2.4 ECB 的安全性讨论</strong></h5><p>尽管 ECB 因其实现简单而在某些应用中仍然被使用，但它通常不推荐用于需要高安全性的场景。因为 ECB 模式对于相同的明文块总是生成相同的密文块，这使得它对于某些类型的数据（尤其是那些包含重复模式的数据）来说，可能会暴露出明显的模式，从而容易被攻击者利用。</p><p><strong>3.3 CBC 模式分析</strong><br>CBC（Cipher Block Chaining）模式是一种广泛使用的块加密操作模式，它通过链式反馈机制增加了加密过程的复杂性和安全性。以下是 CBC 模式的详细介绍，包括设计背景、来历、迭代过程和安全性讨论。</p><h5 id="331-cbc模式的设计背景"><a class="anchor" href="#331-cbc模式的设计背景">#</a> <strong>3.3.1 CBC 模式的设计背景</strong></h5><p>CBC 模式在 1970 年代被 IBM 开发，目的是为了克服电子密码本（ECB）模式的一些显著安全缺陷。在 ECB 模式中，相同的明文块加密后会产生相同的密文块，这使得模式信息可能被泄露。这种特性特别不适用于加密大量数据或具有重复数据块的文件。因此，需要一种更安全的模式来提供更好的数据保密性，尤其是在数据块之间存在高度关联时。</p><h5 id="332-cbc模式的来历"><a class="anchor" href="#332-cbc模式的来历">#</a> <strong>3.3.2 CBC 模式的来历</strong></h5><p>CBC 模式的设计利用了前一个块的密文来影响当前块的加密过程。这种设计首次在 IBM 的 Lucifer 加密算法中被提出并应用，后来这一概念被采纳并广泛应用于多种加密标准中，包括现代加密算法如 AES 和 DES。</p><h5 id="333-cbc模式的迭代构成"><a class="anchor" href="#333-cbc模式的迭代构成">#</a> <strong>3.3.3 CBC 模式的迭代构成</strong></h5><p>CBC 模式的加密过程包括以下几个步骤：</p><p>初始化向量（IV）：加密的第一个数据块需要一个初始化向量，这个向量通常是随机生成的，与明文一起发送，但不需要保密。</p><p>链式反馈：每个明文块在加密之前，首先与前一个密文块进行 XOR 运算。对于第一个明文块，它与 IV 进行 XOR。</p><p>块加密：XOR 运算后的结果使用加密算法和密钥进行加密。</p><p>生成密文块：加密的输出形成当前的密文块，然后这个密文块被用于下一个块的加密过程。</p><p>解密过程则是加密过程的逆操作：</p><p>块解密：使用相同的密钥对密文块进行解密。</p><p>XOR 运算：将解密后的输出与前一个密文块进行 XOR 运算，以恢复原始明文。对于第一个块，使用 IV 进行 XOR 运算。</p><p>恢复明文块：输出最终的明文块。</p><h5 id="334-cbc模式的安全性讨论"><a class="anchor" href="#334-cbc模式的安全性讨论">#</a> <strong>3.3.4 CBC 模式的安全性讨论</strong></h5><p>CBC 模式提供了比 ECB 更高的安全性，主要是因为它通过引入链式依赖机制抵消了明文中的模式。即便明文块完全相同，由于每个块与前一个块的密文相关联，因此相同的明文块不会生成相同的密文块。这种属性使得 CBC 模式对于模式分析和重放攻击具有很强的抵抗力。</p><p>然而，CBC 模式并非完美无缺。例如，它容易受到填充攻击（如 Padding Oracle 攻击），因为加密过程依赖于块的完整性和正确的填充。此外，CBC 模式不提供身份验证，所以它可能受到篡改攻击，除非与消息认证码（MAC）或其他认证机制一起使用。</p><p>总的来说，CBC 模式是一个在多个领域得到广泛应用的块加密模式，它提供了比 ECB 模式更高的安全保障，但需要正确实施和可能的安全增强来保护数据安全。</p><h2 id="4-ublock加密算法的总体框架与数据结构"><a class="anchor" href="#4-ublock加密算法的总体框架与数据结构">#</a> 4. <strong>uBlock 加密算法的总体框架与数据结构</strong></h2><h4 id="41-ublock算法的总体框架"><a class="anchor" href="#41-ublock算法的总体框架">#</a> 4.1 <strong>uBlock 算法的总体框架</strong></h4><p>uBlock 一共包含 3 个版本，分组长度为 128 或 256 比特，密钥长度为 128 或者 256 比特，记为 uBlock-128/128 (明密文块 / 密钥)、uBlock-128/256、uBlock-256/256。三者的加解密基本一致，区别在于三个版本的迭代轮数 r 分别为 16,24,24。并且在轮密钥生成的时候，所用的向量置换分别为 16 字节的<strong> PK****1</strong>、32 字节的<strong> PK****2</strong>、32 字节的<strong> PK****3</strong>。<br><strong>4.1.1 uBlock 加密算法</strong><br>下图是 uBlock 的加密伪代码与流程图示：</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps16.jpg)![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps17.jpg)</p><p>图 1（左）uBlock 的加密伪代码</p><p>图 2（右）uBlock 加密轮变换流程图</p><p>其中，我们可以由图示描述该加密算法即先把 n 比特明文 X 拆分成两个 n/2 比特的 X0 和 X1。根据明文 - 比特的关系选择合适的 r，并且在 0~r-1 范围内做 r 次加密其中每次加密:</p><p>\1. 先将 n 比特轮密钥 RKi 拆分成两个并置的密钥 RK0i 和 RK1i</p><p>\2. 调用一个 n/8 个 S 盒的并置 Sn。首先将 X0 异或 RK0i 后在 Sn 里查表得到新的 X0，然后将 X1 异或 RK1i 后在 Sn 里查表得到新的 X1</p><p>\3. X0 和 X1 异或后得到新的 X1。</p><p>\4. 将 32 位分块 X1 循环左移 4 比特后与 X0 异或得到新的 X0</p><p>\5. 将 32 位分块 X0 循环左移 8 比特后与 X1 异或得到新的 X1</p><p>\6. 将 32 位分块 X1 循环左移 8 比特后与 X0 异或得到新的 X0</p><p>\7. 将 32 位分块 X0 循环左移 20 比特后与 X1 异或得到新的 X1</p><p>\8. 将最终得到的 X0 和 X1 异或得到 X0</p><p>\9. 将 X0 在 n/16 向量置换 PLn (X0) 中进行置换</p><p>\10. 将 X1 在 n/16 向量置换 PRn (X1) 中进行置换<br>最终的密文 Y 即为第 r 轮密钥 RKr 与最终得到的 X0 和 X1 的并置进行异或。</p><p>表 2 S 盒<br>！[img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps18.jpg)</p><p>表 3 PLn 和 PRn</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps19.jpg)</p><h5 id="412-ublock-解密算法"><a class="anchor" href="#412-ublock-解密算法">#</a> <strong>4.1.2 uBlock 解密算法</strong></h5><p>下图为 uBlock 的解密过程，即加密函数的逆变换，其中的 Sn-1、PLn-1、PRn-1 分别是 Sn、PLn 和 PRn 的逆，具体见表 3 和表 4.<br>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps20.jpg)</p><p>图 3 uBlock 解密算法伪代码</p><p>表 4 s-1 盒</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps21.jpg)</p><p>表 5 PLn-1 和 PRn-1<br>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps22.jpg)</p><h5 id="413-ublock密钥扩展算法"><a class="anchor" href="#413-ublock密钥扩展算法">#</a> <strong>4.1.3 uBlock 密钥扩展算法</strong></h5><p>将 k 比特密钥 K 放置在 k 比特寄存器，取寄存器的左 n 比特作为轮密钥 RK0 ，然后，对 1, 2,..., i r = ，更新寄存器，并取寄存器的左 n 比特作为轮密钥 RKi。具体更新方式如下：</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps23.jpg)![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps24.jpg)</p><p>图 4（左） 密钥扩展算法伪代码</p><p>图 5（右） 密钥拓展算法流程图</p><p>其中 Sk 是 k/16 个 4 比特 s 盒的并置，Tk 是对 K1 的每半字节⊗2，有限域 GF (24) 的不可约多项式 m (x)= x4+ x + 1:RCi 为 32 比特常数，作用在 K0 的左 32 比特。PKt 有三种情况，t =1, 2,3，PK1、PK2 和 PK3 分别用于 uBlock-128/128、uBlock-128/256 和 uBlock-256/256 的密钥扩展算法。PK1 是 16 个半字节的向量置换，PK2 和 PK3 都是 32 个半字节的向量置换，具体见下表。</p><p>表 6 PKi 表</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps25.jpg)<br>32 比特常数 RCi 生成具体是由 8 级 LFSR，初始条件为 c0=c3=c6=c7=0,c1=c2=c4=c5=1; 对于 i≥8，ci=ci-2⊕ci-3⊕ci-7⊕ci-8。令<br>！[img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps26.png) ![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps27.png) ![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps28.png) ![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps29.png)<br>则 RCi=![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps30.png)</p><p>常数 RCi（i=1,2.......24）的 16 进制如下表：</p><p>表 7 RCi 表<br>！[img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps31.jpg)</p><h4 id="42-ublock算法的数据结构"><a class="anchor" href="#42-ublock算法的数据结构">#</a> 4.2 <strong>uBlock 算法的数据结构</strong></h4><h5 id="421-s盒-substitution-boxes"><a class="anchor" href="#421-s盒-substitution-boxes">#</a> 4.2.1 <strong>S 盒 (Substitution boxes)</strong></h5><p>S 盒用于执行非线性变换，是密码算法中用于提高安全性的重要组件。它通过将输入的固定大小比特块映射到输出的操作来抵抗线性和差分密码分析。</p><p>在 uBlock 中，S 盒是 4 比特的，即每个 S 盒将 4 比特的输入映射到 4 比特的输出。由于 uBlock 处理 128 比特或 256 比特的数据块，因此需要多个这样的 S 盒并置使用，以覆盖整个数据块。</p><h5 id="422-向量置换-vector-permutations"><a class="anchor" href="#422-向量置换-vector-permutations">#</a> 4.2.2 <strong>向量置换 (Vector Permutations)</strong></h5><p>向量置换用于重新排列加密数据的比特，增强密码的扩散性。这种扩散确保了输入的微小变化可以影响到输出的多个比特，从而增加破解难度。</p><p>uBlock 算法使用两种主要的向量置换，分别称为 PL 和 PR。这些置换是预定义的，并根据不同的加密需求（如 128 比特或 256 比特）进行调整。</p><h5 id="423-轮密钥-round-keys"><a class="anchor" href="#423-轮密钥-round-keys">#</a> 4.2.3 <strong>轮密钥 (Round Keys)</strong></h5><p>轮密钥用于各加密轮中与数据进行 XOR 运算，是提供加密强度的关键。不同的轮使用不同的轮密钥，以防止重复使用相同密钥带来的安全风险。</p><p>轮密钥通过密钥扩展算法从主密钥生成。在 uBlock 中，密钥扩展包括使用 S 盒、固定的置换模式（PK1, PK2, PK3）和轮常数，为每一轮生成唯一的轮密钥。</p><h5 id="424-密钥扩展算法-key-schedule"><a class="anchor" href="#424-密钥扩展算法-key-schedule">#</a> 4.2.4 <strong>密钥扩展算法 (Key Schedule)</strong></h5><p>密钥扩展算法用于生成足够数量的轮密钥，支持加密过程中每一轮的需要。</p><p>这一算法涉及到对原始密钥的多次变换，包括应用 S 盒、向量置换和与轮常数的 XOR 运算。这些操作增加了密钥的不可预测性和算法的整体安全性。</p><h5 id="425-数据块的处理"><a class="anchor" href="#425-数据块的处理">#</a> 4.2.5 <strong>数据块的处理</strong></h5><p>在 uBlock 算法中，明文数据块根据算法版本（128 比特或 256 比特）被处理。每次加密操作对数据块进行分割、替换、置换和合并。</p><p>数据在加密过程中经历多个阶段的处理，包括并置、分割和轮内操作，这些操作通过特定的加密逻辑紧密结合。</p><p>这些组件共同构成了 uBlock 算法的核心，通过精心设计的数据处理步骤和算法结构，uBlock 能够有效地在保护信息安全的同时，维持处理效率。这种设计不仅使其在理论上安全，而且在实际应用中也表现出高效的执行能力，适应于各种硬件和软件环境。</p><h2 id="5-ublock的算法实现"><a class="anchor" href="#5-ublock的算法实现">#</a> 5. <strong>uBlock 的算法实现</strong></h2><h4 id="51-基础代码设计"><a class="anchor" href="#51-基础代码设计">#</a> <strong>5.1 基础代码设计</strong></h4><p>通过综合考虑通用性和常用性，我们在这主要介绍 uBlock128/128 版本的加密算法代码实现。首先我根据设计文档和已给代码来编写出<strong> uBlock_Windows_128_128.cpp</strong> 文件，代码附于附件<br>主要函数包括：<br>（1）密钥调度（uBlock_128_KeySchedule 函数）：此函数接收一个密钥并生成多个轮次密钥，存储在 Subkey 数组中。它利用了 SIMD 指令来并行处理多个操作，提高了密钥生成的效率。</p><p>（2）加密函数（uBlock_128_Encrypt）：此函数实现了加密过程，使用预先生成的轮次密钥对输入的明文进行加密，产生密文。加密过程包括多个轮次，每个轮次都使用不同的密钥和数据转换，例如置换和替代。</p><p>（3）解密函数（uBlock_128_Decrypt）：与加密函数类似，但按相反顺序应用轮次密钥和转换，以从密文恢复明文</p><p>（4）CBC 模式实现（Crypt_Enc_Block_CBC 和 Crypt_Dec_Block_CBC 函数）：这些函数实现了密码块链接（CBC）模式的加密和解密。在 CBC 模式中，每个块的加密依赖于前一个块的加密输出，提高了加密过程的安全性。</p><p>（5）ECB 模式实现（Crypt_Enc_Block_ECB 和 Crypt_Dec_Block_ECB 函数）：这些函数实现了密码块链接（ECB）模式的加密和解密。</p><p>首先我们给出在 vscode 上将<strong> uBlock_Windows_128_128.cpp</strong> 编译成 exe 的代码为 “<strong>g++ &quot;-msse4.1&quot; -o main uBlock_Windows_128_128.cpp</strong>”。<br>接下来我仅附 ECB 和 CBC 加解密代码，其余代码请参考附件：</p><ol><li>int Crypt_Enc_Block_CBC(unsigned char *input, int in_len, unsigned char *output, int <em>out_len, unsigned char <em>key, int keylen)2.<ruby>3. int g, j;4. unsigned char iv[16] = {0};5. uBlock_128_KeySchedule(key);6. for (g = 0; g &lt; in_len / 16; g++)7. {8. for(j = 0; j &lt; 16; j++)9. {10. iv[j] <rp>(</rp><rt>input[g * 16 + j];11.</rt><rp>)</rp></ruby>12. uBlock_128_Encrypt(iv, output+g</em>16, 16);13. memcpy(iv, output+g</em>16, 16);14. }15. *out_len = in_len - in_len % 16;16. 17. return 0;18. }19. 20. int Crypt_Dec_Block_CBC(unsigned char *input,int in_len, unsigned char *output,int *out_len, unsigned char <em>key, int keylen)21.<ruby>22. int g, j;23. unsigned char iv[16] = {0};24. 25. uBlock_128_KeySchedule(key);26. 27. for (g = 0; g &lt; in_len / 16; g++)28. {29. uBlock_128_Decrypt(input+g*16, output+g*16, 16);30. for(j = 0; j &lt; 16; j++)31. {32. output[g * 16 + j] <rp>(</rp><rt>iv[j];33.</rt><rp>)</rp></ruby>34. memcpy(iv, input+g</em>16, 16);35. }36. *out_len = in_len - in_len % 16;37. return 0;38. }39. int Crypt_Enc_Block_ECB(unsigned char *input, int in_len, unsigned char *output, int *out_len, unsigned char *key, int keylen)40. {41. int g;42. 43. uBlock_128_KeySchedule(key);44. 45. for (g = 0; g &lt; in_len / 16; g++)46. {47. uBlock_128_Encrypt(input + g * 16, output + g * 16, 16); 48. }49. *out_len = in_len - in_len % 16;50. return 0;51. }52. int Crypt_Dec_Block_ECB(unsigned char *input, int in_len, unsigned char *output, int *out_len, unsigned char *key, int keylen)53. {54. int g; 55. uBlock_128_KeySchedule(key);56. for (g = 0; g &lt; in_len / 16; g++)57. {58. uBlock_128_Decrypt(input + g * 16, output + g * 16, 16); 59. }60. *out_len = in_len - in_len % 16;61. return 0;62. }</li></ol><p>我的算法流程图如下：<br>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps32.jpg)</p><p>图 6 代码流程图（AI 识别代码生成）</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps33.jpg)</p><p>图 7 uBlock 代码设计流程图</p><h5 id="52-评估正确性"><a class="anchor" href="#52-评估正确性">#</a> <strong>5.2 评估正确性</strong></h5><p>依据官方文档中的测试函数，以：<br>明文：01 23 45 67 89 ab cd effe dc ba 98 76 54 32 10</p><p>密钥：01 23 45 67 89 ab cd effe dc ba 98 76 54 32 10</p><p>加密 1 次时，输出的密文应该是 32 12 2b ed d0 23 c4 29 02 34 70 e1 15 8c 14 7d</p><p>加密 1000000 时，输出的密文应该是 9d 63 9e 31 06 2f fb 57 46 46 e4 28 f9 2e 08 d4</p><p>根据我们的代码生成结果，如下图（中间部分为其他测试结果）：<br>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps34.jpg)</p><p>图 8 uBlock 代码输出结果</p><p>如上图我们可以知道，代码的正确性良好。与官方文档符合。</p><p>根据后续输出，我们可以发现代码生成的轮密钥也与官方文档一致，代码可行度高。</p><h5 id="53-评估吞吐量和速度"><a class="anchor" href="#53-评估吞吐量和速度">#</a> <strong>5.3 评估吞吐量和速度</strong></h5><p>我的电脑使用的是 NVIDIA GeForce RTX 3070 Ti Laptop GPU、处理器	12th Gen Intel (R) Core (TM) i9-12900H，2500 Mhz，14 个内核，20 个逻辑处理器、BIOS 版本 / 日期 American Megatrends International, LLC. G533ZW.324, 2023/2/21。其中我的 Python 解释器是 Python3.11，编译器是 pycharm2023.7 专业版。而我的 cpp 运行软件为 vscode。<br>这里我以将信息反复加密 1000000 次的时间作为标准。以其运行的时间作为评价的指标。当我们明文和密文均为 01 23 45 67 89 ab cd effe dc ba 98 76 54 32 10 时，多次运算测试代码取平均值可以得到：<br>uBlock 128-128 的运算时间为 1.162s![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps35.jpg)</p><p>uBlock 128-256 的运算时间为 1.381s![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps36.jpg)</p><p>uBlock 256-256 的运算时间为 1.605s![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps37.jpg)</p><p>而在 Python 上运行的传统 AES 代码的运行时间为 29.93s![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps38.jpg)</p><p>其中不排除 C++ 运行效率比 Python 高效等因素。但是总体来说，uBlock 在无论是吞吐量还是运行速度方向都表现出较高的效率和运算速度。相比于传统 AES 加密算法显得更加高效的同时准确率也表现得很优异。</p><h2 id="6-以ublock的ecb和cbc模式加密朱鹮bmp文件"><a class="anchor" href="#6-以ublock的ecb和cbc模式加密朱鹮bmp文件">#</a> <strong>6 以 uBlock 的 ECB 和 CBC 模式加密朱鹮.bmp 文件</strong></h2><h4 id="61-bmp文件格式解析"><a class="anchor" href="#61-bmp文件格式解析">#</a> <strong>6.1 BMP 文件格式解析</strong></h4><p>BMP 文件格式，全称为 Bitmap Image File Format，是一种图像文件格式，广泛用于 Windows 操作系统中存储位图图像。这种格式简单、直观，支持多种色深，并可以无损地存储图像数据。BMP 文件主要由三部分组成：</p><p><em><strong>*(1)*</strong></em><em><strong>* 文件头 *</strong></em>（Bitmap File Header）：<br>包含文件类型、文件大小和数据偏移等信息。</p><p>bfType（2 字节）：文件类型，必须是 'BM'，用以标识文件为 BMP 格式。</p><p>bfSize（4 字节）：整个文件的大小，包括文件头、信息头和位图数据。</p><p>bfReserved1 和 bfReserved2（各 2 字节）：保留位，对齐用，通常为 0。</p><p>bfOffBits（4 字节）：从文件开始到位图数据的偏移量。</p><p><em><strong>*(2)*</strong></em><em><strong>* 信头 *</strong></em>（DIB Header，即 Device Independent Bitmap Header）：BMP 文件的信息头有几种不同的版本，最常见的包括 BITMAPINFOHEADER 和 BITMAPV5HEADER 等。以 BITMAPINFOHEADER 为例，其结构如下：</p><p>提供图像宽度、高度、色深、压缩类型等详细信息。</p><p>biSize（4 字节）：此结构体的大小。</p><p>biWidth（4 字节）：图像的宽度（像素）。</p><p>biHeight（4 字节）：图像的高度（像素）。如果为正，位图是倒向的；如果为负，位图是正向的。biPlanes（2 字节）：目标设备的级别，必须为 1。</p><p>biBitCount（2 字节）：每个像素所需的位数，常见的有 1、4、8、16、24 和 32。</p><p>biCompression（4 字节）：位图的压缩类型。</p><p>biSizeImage（4 字节）：位图数据的大小，即像素数据部分的大小。</p><p>biXPelsPerMeter, biYPelsPerMeter（各 4 字节）：水平和垂直分辨率（每米像素数）。</p><p>biClrUsed（4 字节）：位图实际使用的颜色表中的颜色索引数（0 表示使用所有的颜色）。</p><p>biClrImportant（4 字节）：重要颜色数，0 表示所有颜色都是重要的。</p><p><em><strong>*(3)*</strong></em><em><strong>* 位图数据 *</strong></em>（Bitmap Data）：<br>实际的图像像素数据 —— 位图数据部分存储实际的图像像素值。这部分的存储格式依赖于 biBitCount 的值。数据可能需要根据行来进行填充，以确保每行的字节数是 4 的倍数（DWORD 对齐）。</p><h4 id="62-bmp文件加密技巧"><a class="anchor" href="#62-bmp文件加密技巧">#</a> <strong>6.2 bmp 文件加密技巧</strong></h4><p>当使用 uBlock 或任何其他块加密算法对 BMP 文件进行加密时，主要关注的是位图数据部分。文件头和信息头通常不进行加密，以便保持文件格式的完整性，使图像文件仍然能被图像查看器识别。以下是一些注意事项和技巧：</p><p>保持文件头和信息头不变：加密时应跳过这部分，直接从位图数据开始加密，这样不会破坏文件的结构 —— 在代码中体现为对 BMP 的前 54 个字节（文件头）不进行加密，以保证图片格式可以清晰显示</p><p>处理数据填充：由于加密算法通常要求数据块大小固定，而 BMP 行可能不会恰好符合这种分块，所以加密前需要对数据进行适当的填充</p><p>选择加密模式：使用 ECB 模式可能会导致图像中的模式被重复，使得加密不够安全。CBC 模式是一个更好的选择，因为它使用初始化向量（IV）来增加加密强度 —— 但是由于老师要求，这里使用 ECB 和 CBC 两种模式来进行加密。</p><h4 id="63-ecb和cbc模式加解密结果"><a class="anchor" href="#63-ecb和cbc模式加解密结果">#</a> <strong>6.3 ECB 和 CBC 模式加解密结果</strong></h4><h5 id="631-ecb模式进行加解密"><a class="anchor" href="#631-ecb模式进行加解密">#</a> <strong>6.3.1 ECB 模式进行加解密</strong></h5><p>在附件中通过 vscode 启动 uBlock_bmp (加密代码)——ECB 加密 .cpp 代码，该代码以 {0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 0xFE, 0xDC, 0xBA, 0x98, 0x76, 0x54, 0x32, 0x10}; 为密钥，循环读入朱鹮.bmp 进行加解密。加密朱鹮.bmp 产生朱鹮_ECB.bmp。读入朱鹮_ECB.bmp 解密后产生朱鹮_ECB_dec.bmp。具体的加密算法请见附件。加密结果如下图:</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps39.jpg)![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps40.jpg)</p><p>图 9（左）朱鹮_ECB.bmp</p><p>图 10（右）朱鹮_ECB_dec.bmp</p><h5 id="632-cbc模式进行加解密"><a class="anchor" href="#632-cbc模式进行加解密">#</a> <strong>6.3.2 CBC 模式进行加解密</strong></h5><p>在附件中通过 vscode 启动 uBlock_bmp (加密代码)——CBC 加密.cpp 代码，该代码以 {0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF, 0xFE, 0xDC, 0xBA, 0x98, 0x76, 0x54, 0x32, 0x10}; 为密钥，循环读入朱鹮.bmp 进行加解密。加密朱鹮.bmp 产生朱鹮_CBC.bmp。读入朱鹮_CBC.bmp 解密后产生朱鹮_CBC_dec.bmp。具体的加密算法请见附件。加密结果如下图：</p><p>![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps41.jpg)![img](file:///C:\Users\JackDu\AppData\Local\Temp\ksohtml29368\wps42.jpg)</p><p>图 11（左）朱鹮_CBC.bmp</p><p>图 12（右）朱鹮_CBC_dec.bmp</p><h5 id="633-ecb和cbc模式的分析与对比"><a class="anchor" href="#633-ecb和cbc模式的分析与对比">#</a> <strong>6.3.3 ECB 和 CBC 模式的分析与对比</strong></h5><p><em><strong>* 安全性：*</strong></em></p><p>CBC 模式通常比 ECB 模式更安全，因为它避免了明文中的模式在密文中的重复 ——CBC 模式加密前，每个数据块都会与前一个密文块进行异或。第一块数据与一个初始向量（IV）进行异或。这种方法使得相同的明文块加密后的结果因其位置不同而不同，提高了安全性。同样的明文在不同的位置或在不同的文件中，即使使用相同的密钥，加密结果也会不同。</p><p>而 ECB 模式将数据分割成块，每块数据独立加密。缺点是同一块明文在同一密钥下总是被加密成同样的密文块。这意味着模式可能会暴露明文的模式，特别是当处理大量具有重复模式的数据时（例如图片或某些类型的文档）。在图像加密（如本次的 bmp）中尤其明显，因为图像中经常包含大片相同颜色的区域。</p><p><em><strong>* 性能：*</strong></em></p><p>ECB 模式可以并行处理，因为每个数据块独立加密，提高了加密过程的速度。而 CBC 模式不能并行处理，因为每个块的加密依赖于前一个块的密文。这可能会在处理大量数据时导致性能下降。解密可以并行化，因为解密过程中，每个块的解密只依赖于它前面的一个块的密文。</p><h2 id="7-总结"><a class="anchor" href="#7-总结">#</a> <strong>7 总结</strong></h2><p>在这篇论文中，我对 uBlock 和 ECB 两种加密算法进行了深入的研究与比较。通过细致的分析，我发现 uBlock 算法具有复杂的密钥扩展和多轮加密机制，这些设计显著增强了其加密强度和安全性，使其特别适用于对数据安全要求极高的场景。相比之下，ECB 模式因其简单的结构，在处理具有重复模式的大量数据时表现出安全性的不足，尤其在需要高安全性的应用中可能导致数据泄露风险。</p><p>我还特别关注了这两种算法在不同硬件和软件环境中的性能表现。研究结果显示，uBlock 在现代处理器上具有出色的运行效率和较低的资源消耗，这使得它非常适合在需要快速数据处理和高吞吐量的系统中使用。此外，我也评估了 ECB 模式的实现简便性，这一特点使其在某些不需要高安全性的内部或封闭系统中仍具有应用价值。</p><p>通过本研究，我进一步理解了在算法设计中安全性和效率的重要性以及如何在实际应用中做出适当的权衡。论文的这部分研究不仅增强了我对加密算法性能和安全性的认识，也为将来选择和设计加密方案提供了实用的指导。</p><p>最后，展望未来，我认为加密算法的发展需要持续关注安全性的提升和性能的优化。随着计算资源的发展和安全威胁的演变，持续更新和改进加密技术将是确保信息安全的关键。因此，我期待在未来的工作中，进一步探索和实验新的加密技术，以应对更为复杂和多变的安全环境。这篇论文为我在密码学领域的研究提供了坚实的基础，并激励我继续在这一领域深入探索与创新。</p><div class="tags"><a href="/tags/Hexo/" rel="tag"><i class="ic i-tag"></i> Hexo</a> <a href="/tags/Front-Matter/" rel="tag"><i class="ic i-tag"></i> Front Matter</a> <a href="/tags/code/" rel="tag"><i class="ic i-tag"></i> code</a> <a href="/tags/recommendation/" rel="tag"><i class="ic i-tag"></i> recommendation</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2024-07-14 01:09:42" itemprop="dateModified" datetime="2024-07-14T01:09:42+08:00">2024-07-14</time> </span><span id="bit/密码工程/" class="item leancloud_visitors" data-flag-title="密码工程大作业" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Jack Du WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/alipay.png" alt="Jack Du Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="Jack Du PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Jack Du <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>Post link: </strong><a href="https://enjundu.github.io/bit/%E5%AF%86%E7%A0%81%E5%B7%A5%E7%A8%8B/" title="密码工程大作业">https://enjundu.github.io/bit/密码工程/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/ctf/nscweb%E6%8E%88%E8%AF%BE_prepare/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2024&#x2F;07&#x2F;04&#x2F;n89zJmuTd1cqNrW.jpg" title="NSC暑期培训——web"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> Capture-the-Flag</span><h3>NSC暑期培训——web</h3></a></div><div class="item right"><a href="/ECEBC/%E9%AB%98%E5%BE%B7%E6%89%BE%E6%88%BF/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2024&#x2F;07&#x2F;03&#x2F;sTHU7wL5qkSiloC.jpg" title="高德找房"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> 嵩天的爱-ECE-BC</span><h3>高德找房</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#code"><span class="toc-number">1.</span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ublock_bmp%E5%8A%A0%E5%AF%86%E4%BB%A3%E7%A0%81cbc%E5%8A%A0%E5%AF%86cpp"><span class="toc-number">1.1.</span> <span class="toc-text">uBlock_bmp (加密代码)——CBC 加密.cpp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ublock_bmp%E5%8A%A0%E5%AF%86%E4%BB%A3%E7%A0%81ecb%E5%8A%A0%E5%AF%86-cpp"><span class="toc-number">1.2.</span> <span class="toc-text">uBlock_bmp (加密代码)——ECB 加密 .cpp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ublock_bmp%E5%8A%A0%E5%AF%86%E4%BB%A3%E7%A0%81ecb%E5%8A%A0%E5%AF%86cpp"><span class="toc-number">1.3.</span> <span class="toc-text">uBlock_bmp (加密代码)——ECB 加密.cpp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ublock_windows_128_128-_%E6%B5%8B%E8%AF%95%E6%97%B6%E9%97%B4cpp"><span class="toc-number">1.4.</span> <span class="toc-text">uBlock_Windows_128_128 _测试时间.cpp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eublock%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E7%9A%84%E8%B0%83%E7%A0%94%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">关于 uBlock 加密算法的调研分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Eublock%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E7%9A%84%E8%B0%83%E7%A0%94%E5%88%86%E6%9E%90-2"><span class="toc-number">3.</span> <span class="toc-text">关于 uBlock 加密算法的调研分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BC%95%E8%A8%80"><span class="toc-number">3.1.</span> <span class="toc-text">1 引言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#22-ublock%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">2.2 uBlock 术语解释</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#221-%E5%B9%B6%E7%BD%AE"><span class="toc-number">3.1.0.1.1.</span> <span class="toc-text">2.2.1 并置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#223-%E5%90%91%E9%87%8F%E7%BD%AE%E6%8D%A2permutation-of-vectors"><span class="toc-number">3.1.0.1.2.</span> <span class="toc-text">2.2.3 向量置换（Permutation of Vectors）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#224%E8%BD%AE%E5%AF%86%E9%92%A5round-key"><span class="toc-number">3.1.0.1.3.</span> <span class="toc-text">2.2.4 轮密钥（Round Key）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3ublock%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%8F%8A%E4%B8%A4%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9D%A5%E5%8E%86"><span class="toc-number">3.2.</span> <span class="toc-text">3.uBlock 分组密码及两种工作模式的来历</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#31-ublock%E7%AE%97%E6%B3%95%E6%9D%A5%E5%8E%86"><span class="toc-number">3.2.0.1.</span> <span class="toc-text">3.1 uBlock 算法来历</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-ecb%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E6%A8%A1%E5%BC%8F%E6%9D%A5%E5%8E%86"><span class="toc-number">3.2.0.2.</span> <span class="toc-text">3.2 ECB 分组密码模式来历</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#321-ecb%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%83%8C%E6%99%AF"><span class="toc-number">3.2.0.2.1.</span> <span class="toc-text">3.2.1 ECB 的设计背景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#322-ecb%E7%9A%84%E6%9D%A5%E5%8E%86"><span class="toc-number">3.2.0.2.2.</span> <span class="toc-text">3.2.2 ECB 的来历</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#323-ecb%E7%9A%84%E8%BF%AD%E4%BB%A3%E8%BF%87%E7%A8%8B"><span class="toc-number">3.2.0.2.3.</span> <span class="toc-text">3.2.3 ECB 的迭代过程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#324-ecb%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E8%AE%A8%E8%AE%BA"><span class="toc-number">3.2.0.2.4.</span> <span class="toc-text">3.2.4 ECB 的安全性讨论</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#331-cbc%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%83%8C%E6%99%AF"><span class="toc-number">3.2.0.2.5.</span> <span class="toc-text">3.3.1 CBC 模式的设计背景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#332-cbc%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%9D%A5%E5%8E%86"><span class="toc-number">3.2.0.2.6.</span> <span class="toc-text">3.3.2 CBC 模式的来历</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#333-cbc%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%BF%AD%E4%BB%A3%E6%9E%84%E6%88%90"><span class="toc-number">3.2.0.2.7.</span> <span class="toc-text">3.3.3 CBC 模式的迭代构成</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#334-cbc%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E8%AE%A8%E8%AE%BA"><span class="toc-number">3.2.0.2.8.</span> <span class="toc-text">3.3.4 CBC 模式的安全性讨论</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#4-ublock%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E7%9A%84%E6%80%BB%E4%BD%93%E6%A1%86%E6%9E%B6%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.</span> <span class="toc-text">4. uBlock 加密算法的总体框架与数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#41-ublock%E7%AE%97%E6%B3%95%E7%9A%84%E6%80%BB%E4%BD%93%E6%A1%86%E6%9E%B6"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">4.1 uBlock 算法的总体框架</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#412-ublock-%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-number">3.3.0.1.1.</span> <span class="toc-text">4.1.2 uBlock 解密算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#413-ublock%E5%AF%86%E9%92%A5%E6%89%A9%E5%B1%95%E7%AE%97%E6%B3%95"><span class="toc-number">3.3.0.1.2.</span> <span class="toc-text">4.1.3 uBlock 密钥扩展算法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#42-ublock%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.0.2.</span> <span class="toc-text">4.2 uBlock 算法的数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#421-s%E7%9B%92-substitution-boxes"><span class="toc-number">3.3.0.2.1.</span> <span class="toc-text">4.2.1 S 盒 (Substitution boxes)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#422-%E5%90%91%E9%87%8F%E7%BD%AE%E6%8D%A2-vector-permutations"><span class="toc-number">3.3.0.2.2.</span> <span class="toc-text">4.2.2 向量置换 (Vector Permutations)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#423-%E8%BD%AE%E5%AF%86%E9%92%A5-round-keys"><span class="toc-number">3.3.0.2.3.</span> <span class="toc-text">4.2.3 轮密钥 (Round Keys)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#424-%E5%AF%86%E9%92%A5%E6%89%A9%E5%B1%95%E7%AE%97%E6%B3%95-key-schedule"><span class="toc-number">3.3.0.2.4.</span> <span class="toc-text">4.2.4 密钥扩展算法 (Key Schedule)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#425-%E6%95%B0%E6%8D%AE%E5%9D%97%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">3.3.0.2.5.</span> <span class="toc-text">4.2.5 数据块的处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-ublock%E7%9A%84%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.4.</span> <span class="toc-text">5. uBlock 的算法实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#51-%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.4.0.1.</span> <span class="toc-text">5.1 基础代码设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#52-%E8%AF%84%E4%BC%B0%E6%AD%A3%E7%A1%AE%E6%80%A7"><span class="toc-number">3.4.0.1.1.</span> <span class="toc-text">5.2 评估正确性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#53-%E8%AF%84%E4%BC%B0%E5%90%9E%E5%90%90%E9%87%8F%E5%92%8C%E9%80%9F%E5%BA%A6"><span class="toc-number">3.4.0.1.2.</span> <span class="toc-text">5.3 评估吞吐量和速度</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E4%BB%A5ublock%E7%9A%84ecb%E5%92%8Ccbc%E6%A8%A1%E5%BC%8F%E5%8A%A0%E5%AF%86%E6%9C%B1%E9%B9%AEbmp%E6%96%87%E4%BB%B6"><span class="toc-number">3.5.</span> <span class="toc-text">6 以 uBlock 的 ECB 和 CBC 模式加密朱鹮.bmp 文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#61-bmp%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%A7%A3%E6%9E%90"><span class="toc-number">3.5.0.1.</span> <span class="toc-text">6.1 BMP 文件格式解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#62-bmp%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86%E6%8A%80%E5%B7%A7"><span class="toc-number">3.5.0.2.</span> <span class="toc-text">6.2 bmp 文件加密技巧</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#63-ecb%E5%92%8Ccbc%E6%A8%A1%E5%BC%8F%E5%8A%A0%E8%A7%A3%E5%AF%86%E7%BB%93%E6%9E%9C"><span class="toc-number">3.5.0.3.</span> <span class="toc-text">6.3 ECB 和 CBC 模式加解密结果</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#631-ecb%E6%A8%A1%E5%BC%8F%E8%BF%9B%E8%A1%8C%E5%8A%A0%E8%A7%A3%E5%AF%86"><span class="toc-number">3.5.0.3.1.</span> <span class="toc-text">6.3.1 ECB 模式进行加解密</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#632-cbc%E6%A8%A1%E5%BC%8F%E8%BF%9B%E8%A1%8C%E5%8A%A0%E8%A7%A3%E5%AF%86"><span class="toc-number">3.5.0.3.2.</span> <span class="toc-text">6.3.2 CBC 模式进行加解密</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#633-ecb%E5%92%8Ccbc%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%AF%B9%E6%AF%94"><span class="toc-number">3.5.0.3.3.</span> <span class="toc-text">6.3.3 ECB 和 CBC 模式的分析与对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%80%BB%E7%BB%93"><span class="toc-number">3.6.</span> <span class="toc-text">7 总结</span></a></li></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/bit/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AE%9E%E9%AA%8C/" rel="bookmark" title="数据结构实验">数据结构实验</a></li><li><a href="/bit/%E7%BE%8E%E8%B5%9B%E2%80%94%E2%80%94%E4%B8%83%E9%B3%83%E9%B3%97/" rel="bookmark" title="美赛——七鳃鳗">美赛——七鳃鳗</a></li><li><a href="/bit/%E4%BA%9A%E5%A4%AA%E6%95%B0%E6%A8%A1%E2%80%94%E2%80%94%E6%B4%AA%E6%B0%B4%E9%A2%84%E6%B5%8B/" rel="bookmark" title="亚太数模——洪水">亚太数模——洪水</a></li><li><a href="/bit/%E4%BA%9A%E5%A4%AA%E6%95%B0%E6%A8%A1%E2%80%94%E2%80%94%E6%96%B0%E8%83%BD%E6%BA%90%E6%B1%BD%E8%BD%A6/" rel="bookmark" title="亚太数模——新能源汽车">亚太数模——新能源汽车</a></li><li class="active"><a href="/bit/%E5%AF%86%E7%A0%81%E5%B7%A5%E7%A8%8B/" rel="bookmark" title="密码工程大作业">密码工程大作业</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Jack Du" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Jack Du</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">59</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">10</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">tags</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/ctf/nscweb%E6%8E%88%E8%AF%BE_prepare/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/ECEBC/%E9%AB%98%E5%BE%B7%E6%89%BE%E6%88%BF/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/LLMstestoracle/" title="In LLM的test oracle生成">LLM的test oracle生成</a></div><span><a href="/LLMstestoracle/X_artificial-adversary-master/" title="artificial-adversary">artificial-adversary</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/IntroductiontoNetSecurityLab/" title="In 网安导论实验">网安导论实验</a></div><span><a href="/IntroductiontoNetSecurityLab/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%AE%97%E6%B3%95%E5%AE%89%E5%85%A8_%E5%90%8E%E9%97%A8%E6%94%BB%E5%87%BB/" title="人工智能的后门攻击">人工智能的后门攻击</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/LLMstestoracle/" title="In LLM的test oracle生成">LLM的test oracle生成</a></div><span><a href="/LLMstestoracle/1_PythonProjectTemplate-master/" title="PythonProjectTemplate-master">PythonProjectTemplate-master</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/bit/" title="In BIT-study">BIT-study</a></div><span><a href="/bit/%E4%BA%9A%E5%A4%AA%E6%95%B0%E6%A8%A1%E2%80%94%E2%80%94%E6%96%B0%E8%83%BD%E6%BA%90%E6%B1%BD%E8%BD%A6/" title="亚太数模——新能源汽车">亚太数模——新能源汽车</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/IntroductiontoNetSecurityLab/" title="In 网安导论实验">网安导论实验</a></div><span><a href="/IntroductiontoNetSecurityLab/%E9%9A%90%E7%A7%81%E4%BF%9D%E6%8A%A4/" title="隐私保护">隐私保护</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/LLMstestoracle/" title="In LLM的test oracle生成">LLM的test oracle生成</a></div><span><a href="/LLMstestoracle/4_oj-master/" title="online-judge-tools&#x2F;oj">online-judge-tools/oj</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ctf/" title="In Capture-the-Flag">Capture-the-Flag</a></div><span><a href="/ctf/nscweb%E6%8E%88%E8%AF%BE_prepare/" title="NSC暑期培训——web">NSC暑期培训——web</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/recommendation/" title="In 推荐算法相关search">推荐算法相关search</a></div><span><a href="/recommendation/README/" title="b_README">b_README</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/deep-learning/" title="In deep-learning">deep-learning</a></div><span><a href="/deep-learning/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" title="深度学习_1">深度学习_1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/bit/" title="In BIT-study">BIT-study</a></div><span><a href="/bit/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AE%9E%E9%AA%8C/" title="数据结构实验">数据结构实验</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Jack Du @ 蓝天の网站</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"bit/密码工程/",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->